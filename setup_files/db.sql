SET SQL_MODE='ALLOW_INVALID_DATES';
DROP TABLE IF EXISTS `email_validation`;
CREATE TABLE `email_validation` ( `id` int NOT NULL AUTO_INCREMENT, `user_id` varchar(45) DEFAULT NULL, `validation_token` varchar(45) DEFAULT NULL, `validated` int DEFAULT '0', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=13; 
DROP TABLE IF EXISTS `episode_tags`;
CREATE TABLE `episode_tags` ( `id` int NOT NULL AUTO_INCREMENT, `object_id` int DEFAULT NULL, `tag` varchar(100) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=120;
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` ( `id` int NOT NULL AUTO_INCREMENT, `name` text NOT NULL, `can_edit_playlist` bit(1) NOT NULL, `can_create_playlist` bit(1) NOT NULL, `can_list_playlist` bit(1) NOT NULL, `can_edit_episodes` bit(1) NOT NULL, `can_create_episodes` bit(1) NOT NULL, `can_list_episodes` bit(1) NOT NULL, `can_edit_users` bit(1) NOT NULL, `can_create_users` bit(1) NOT NULL, `can_list_users` bit(1) NOT NULL, `can_edit_site_settings` bit(1) NOT NULL, `machine_name` varchar(45) NOT NULL, `permission_over` text NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=5; 
INSERT INTO `roles` VALUES (1,'Administrador',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '','admin','admin,chief_editor,editor,external_user'),(2,'Editor-Chefe',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '',_binary '\0','chief_editor','editor,external_user'),(3,'Editor',_binary '',_binary '\0',_binary '',_binary '',_binary '',_binary '',_binary '\0',_binary '\0',_binary '',_binary '\0','editor',''),(4,'Autor Externo',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0',_binary '\0','external_user','');
DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` ( `id` int NOT NULL AUTO_INCREMENT, `role_id` int NOT NULL, `short_name` varchar(45) NOT NULL, `full_name` varchar(45) NOT NULL, `avatar_url` varchar(45) NOT NULL, `description` text NOT NULL, `visibility` binary(1) NOT NULL, `date_created` timestamp NOT NULL, `created_by_user_id` int NOT NULL, `pwd` varchar(100) NOT NULL, `email` varchar(100) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `short_name_UNIQUE` (`short_name`), KEY `fkIdx_120` (`role_id`), CONSTRAINT `FK_120` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=35;
DROP TABLE IF EXISTS `episodes`;
CREATE TABLE `episodes` ( `id` int NOT NULL AUTO_INCREMENT, `long_title` varchar(300) NOT NULL, `description` longtext NOT NULL, `file_low_quality` varchar(100) NOT NULL, `image_16x9` varchar(300) NOT NULL, `image_1x1` varchar(300) NOT NULL, `date_created` timestamp NOT NULL, `date_modified` timestamp NOT NULL, `playlist_id` int DEFAULT NULL, `created_by_user_id` int NOT NULL, `updated_by_user_id` int NOT NULL, `short_title` varchar(100) NOT NULL, `file_medium_quality` varchar(100) NOT NULL, `file_high_quality` varchar(100) NOT NULL, `duration` int NOT NULL COMMENT 'duration in millis', `guest_user_id` int DEFAULT NULL, `type` enum('mix','podcast') NOT NULL, `tags` varchar(300) NOT NULL, `lang` varchar(45) NOT NULL COMMENT 'pt-PT', `folder` varchar(45) DEFAULT NULL, `marker_data` text, `visibilty` enum('invisible','public','private') DEFAULT 'public', PRIMARY KEY (`id`), KEY `fkIdx_133` (`created_by_user_id`), KEY `fkIdx_136` (`updated_by_user_id`), KEY `fkIdx_145` (`guest_user_id`), CONSTRAINT `FK_133` FOREIGN KEY (`created_by_user_id`) REFERENCES `users` (`id`), CONSTRAINT `FK_136` FOREIGN KEY (`updated_by_user_id`) REFERENCES `users` (`id`), CONSTRAINT `FK_145` FOREIGN KEY (`guest_user_id`) REFERENCES `users` (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=47; 
DROP TABLE IF EXISTS `playlist_items`;
CREATE TABLE `playlist_items` ( `id` int NOT NULL AUTO_INCREMENT, `episode_id` int NOT NULL, `playlist_id` int NOT NULL, `index` int NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=22; 
DROP TABLE IF EXISTS `playlist_tags`;
CREATE TABLE `playlist_tags` ( `id` int NOT NULL AUTO_INCREMENT, `tag` varchar(45) DEFAULT NULL, `object_id` varchar(45) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=20; 
DROP TABLE IF EXISTS `playlists`;
CREATE TABLE `playlists` ( `id` int NOT NULL AUTO_INCREMENT, `episodes` longtext COMMENT 'Serialized array of episode id''s', `title` varchar(100) NOT NULL, `description` longtext, `date_created` timestamp NOT NULL, `date_modified` timestamp NOT NULL, `visibilty` enum('invisible','public','private') NOT NULL DEFAULT 'public', `image_16x9` varchar(45) NOT NULL, `image_1x1` varchar(45) NOT NULL, `type` enum('program','automatic','playlist') NOT NULL COMMENT 'automatic playlists are categories', `created_by_user_id` int NOT NULL, `updated_by_user_id` int NOT NULL, `tags` varchar(300) DEFAULT NULL, `edited_by_user_id` int NOT NULL, `folder` varchar(45) NOT NULL, PRIMARY KEY (`id`), KEY `fkIdx_127` (`created_by_user_id`), KEY `fkIdx_130` (`updated_by_user_id`), KEY `fkIdx_174` (`edited_by_user_id`), CONSTRAINT `FK_127` FOREIGN KEY (`created_by_user_id`) REFERENCES `users` (`id`), CONSTRAINT `FK_130` FOREIGN KEY (`updated_by_user_id`) REFERENCES `users` (`id`), CONSTRAINT `FK_174` FOREIGN KEY (`edited_by_user_id`) REFERENCES `users` (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=21;
DROP TABLE IF EXISTS `site_settings`;
CREATE TABLE `site_settings` ( `current_theme` varchar(45) NOT NULL, `site_url` varchar(140) NOT NULL, `site_name` varchar(45) NOT NULL, `og_image` varchar(45) NOT NULL, `site_description` varchar(45) NOT NULL, `max_upload_size` int NOT NULL, `uploads_folder` varchar(140) NOT NULL, `id` varchar(45) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB;
